{% extends 'myapp/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Minet Dashboard{% endblock %}

{% block content %}
<div style="width: 100%; margin: 0; padding: 2rem 3rem; padding-top: 30px; background-color: #f8f9fa; min-height: 100vh;">
  <!-- Header Section -->
  <div style="text-align: center; margin-bottom: 2.5rem; padding: 2rem; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 75, 135, 0.08);">
    <h1 style="color: #004b87; font-size: 2.8rem; margin-bottom: 1rem; font-weight: 800; letter-spacing: -0.5px; display: flex; align-items: center; justify-content: center; gap: 1rem;">
      <span style="color: #e30613;">MINET</span> Claims Intelligence Platform
    </h1>
    <p style="color: #666; font-size: 1.2rem; max-width: 800px; margin: 0 auto; line-height: 1.6;">
      AI-powered predictive analytics for optimized claims management and strategic decision-making
    </p>
  </div>

  <!-- Main Content Container -->
  <div style="background: white; border-radius: 12px; box-shadow: 0 4px 24px rgba(0, 75, 135, 0.1); overflow: hidden;">
    <!-- Tab Navigation -->
    <div style="display: flex; overflow-x: auto; gap: 0; margin-bottom: 0; scrollbar-width: none; border-bottom: 1px solid #e0e0e0; background: linear-gradient(to right, #f8f9fa, #f1f3f5);">
      <a href="{% url 'minet_forecast_volume' %}" 
         style="flex: 0 0 auto; padding: 1.2rem 2rem; background: {% if request.path == '/minet_forecast_volume/' %}#004b87{% else %}transparent{% endif %}; cursor: pointer; text-decoration: none; color: {% if request.path == '/minet_forecast_volume/' %}white{% else %}#004b87{% endif %}; border-right: 1px solid #e0e0e0; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.8rem;">
        <i class="fas fa-chart-line" style="font-size: 1.1rem;"></i>
        Forecast Volume
      </a>
      
      <a href="{% url 'minet_confidence_interval' %}" 
         style="flex: 0 0 auto; padding: 1.2rem 2rem; background: {% if request.path == '/minet_confidence_interval/' %}#004b87{% else %}transparent{% endif %}; cursor: pointer; text-decoration: none; color: {% if request.path == '/minet_confidence_interval/' %}white{% else %}#004b87{% endif %}; border-right: 1px solid #e0e0e0; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.8rem;">
        <i class="fas fa-chart-area" style="font-size: 1.1rem;"></i>
        Confidence Interval
      </a>
      
      <a href="{% url 'minet_impact_simulation' %}" 
         style="flex: 0 0 auto; padding: 1.2rem 2rem; background: {% if request.path == '/minet_impact_simulation/' %}#004b87{% else %}transparent{% endif %}; cursor: pointer; text-decoration: none; color: {% if request.path == '/minet_impact_simulation/' %}white{% else %}#004b87{% endif %}; border-right: 1px solid #e0e0e0; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.8rem;">
        <i class="fas fa-cogs" style="font-size: 1.1rem;"></i>
        Impact Simulation
      </a>
      
      <a href="{% url 'minet_explainability' %}" 
         style="flex: 0 0 auto; padding: 1.2rem 2rem; background: {% if request.path == '/minet_explainability/' %}#004b87{% else %}transparent{% endif %}; cursor: pointer; text-decoration: none; color: {% if request.path == '/minet_explainability/' %}white{% else %}#004b87{% endif %}; border-right: 1px solid #e0e0e0; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.8rem;">
        <i class="fas fa-lightbulb" style="font-size: 1.1rem;"></i>
        Explainability
      </a>
      
      <a href="#" style="flex: 0 0 auto; padding: 1.2rem 2rem; background: transparent; cursor: pointer; text-decoration: none; color: #004b87; border-right: 1px solid #e0e0e0; font-weight: 600; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.8rem;">
        <i class="fas fa-shield-alt" style="font-size: 1.1rem;"></i>
        Risk Assessment
      </a>
    </div>

    <!-- Tab Content -->
    <div style="padding: 2.5rem;">
      <!-- Content Header -->
      <div style="margin-bottom: 2rem; border-bottom: 1px solid #e0e0e0; padding-bottom: 1.5rem;">
        <h1 style="color: #004b87; font-size: 1.8rem; margin-bottom: 0.5rem; font-weight: 700; display: flex; align-items: center; gap: 1rem;">
          <i class="fas fa-chart-line" style="color: #e30613;"></i>
          Minet Forecasted Claims Volume
        </h1>
        <p style="color: #666; font-size: 1.1rem; margin: 0;">
          Predictive analysis of future claims based on historical patterns
        </p>
      </div>

      {% if error %}
        <div style="padding: 1rem; background-color: #f8d7da; color: #721c24; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #f5c6cb;">
          {{ error }}
        </div>
      {% endif %}

      <!-- Main Card -->
      <div style="margin-bottom: 2rem; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0, 75, 135, 0.1);">
        <!-- Card Header -->
        <div style="background-color: #004b87; color: white; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #e30613;">
          <h3 style="margin: 0; font-size: 1.3rem; font-weight: 600;">Monthly Claims Volume Forecast</h3>
          <div style="display: flex; gap: 1rem;">
            <select id="time-period" style="border: 1px solid #e30613; border-radius: 6px; padding: 0.5rem 1rem; color: #004b87; font-size: 0.9rem; min-width: 150px;">
              <option value="all" {% if selected_time_period == 'all' %}selected{% endif %}>All Time</option>
              <option value="3m" {% if selected_time_period == '3m' %}selected{% endif %}>Last 3 Months</option>
              <option value="6m" {% if selected_time_period == '6m' %}selected{% endif %}>Last 6 Months</option>
              <option value="12m" {% if selected_time_period == '12m' %}selected{% endif %}>Last 12 Months</option>
            </select>

            <select id="benefit-type" style="border: 1px solid #e30613; border-radius: 6px; padding: 0.5rem 1rem; color: #004b87; font-size: 0.9rem; min-width: 180px;">
              <option value="all" {% if selected_benefit_type == 'all' %}selected{% endif %}>All Benefit Types</option>
              {% for benefit in benefit_types %}
                <option value="{{ benefit }}" {% if selected_benefit_type == benefit %}selected{% endif %}>{{ benefit }}</option>
              {% endfor %}
            </select>

            <select id="forecast-months" style="border: 1px solid #e30613; border-radius: 6px; padding: 0.5rem 1rem; color: #004b87; font-size: 0.9rem; min-width: 160px;">
              <option value="3" {% if selected_forecast_months == 3 %}selected{% endif %}>3 Months Forecast</option>
              <option value="6" {% if selected_forecast_months == 6 %}selected{% endif %}>6 Months Forecast</option>
              <option value="12" {% if selected_forecast_months == 12 %}selected{% endif %}>12 Months Forecast</option>
            </select>
          </div>
        </div>
        
        <!-- Card Body -->
        <div style="padding: 1.5rem;">
          {% if visualizations.forecast_volume %}
            {{ visualizations.forecast_volume|safe }}
          {% else %}
            <div style="padding: 1rem; background-color: #fff3cd; color: #856404; border-radius: 8px; text-align: center;">
              No forecast data available
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Two Column Layout -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <!-- Left Column - Raw Data -->
        <div style="border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0, 75, 135, 0.1);">
          <div style="background-color: #004b87; color: white; padding: 1rem 1.5rem;">
            <h3 style="margin: 0; font-size: 1.3rem; font-weight: 600;">Raw Monthly Aggregated Data</h3>
          </div>
          <div style="padding: 1.5rem;">
            {% if visualizations.raw_monthly_data %}
              {{ visualizations.raw_monthly_data|safe }}
            {% else %}
              <div style="padding: 1rem; background-color: #d1ecf1; color: #0c5460; border-radius: 8px; text-align: center;">
                No raw data available
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Right Column - Forecast Accuracy -->
        <div style="border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0, 75, 135, 0.1);">
          <div style="background-color: #004b87; color: white; padding: 1rem 1.5rem;">
            <h3 style="margin: 0; font-size: 1.3rem; font-weight: 600;">Forecast Accuracy</h3>
          </div>
          <div style="padding: 1.5rem;">
            <div style="margin-bottom: 1.5rem;">
              <div style="font-size: 0.9rem; color: #004b87; margin-bottom: 0.5rem; font-weight: 600;">Model Confidence</div>
              <div style="height: 24px; background-color: #e9ecef; border-radius: 6px; overflow: hidden;">
                <div style="height: 100%; background-color: #e30613; width: {{ forecast_accuracy|default:0 }}%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.8rem;">
                  {{ forecast_accuracy|default:0 }}%
                </div>
              </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; gap: 1rem;">
              <div style="text-align: center; padding: 1rem; background-color: #f8f9fa; border-radius: 8px; flex: 1;">
                <div style="font-size: 1.5rem; font-weight: 700; color: #004b87;">{{ forecast_r2|default:"0.000" }}</div>
                <div style="font-size: 0.9rem; color: #666;">R-Squared</div>
              </div>
              
              <div style="text-align: center; padding: 1rem; background-color: #f8f9fa; border-radius: 8px; flex: 1;">
                <div style="font-size: 1.5rem; font-weight: 700; color: #004b87;">KES {{ forecast_mae|default:"0"|intcomma }}</div>
                <div style="font-size: 0.9rem; color: #666;">Mean Absolute Error</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.querySelectorAll('#time-period, #benefit-type, #forecast-months').forEach(select => {
    select.addEventListener('change', function() {
        const url = new URL(window.location.href);
        url.searchParams.set(this.id, this.value);
        window.location.href = url.toString();
    });
});
</script>
{% endblock %}